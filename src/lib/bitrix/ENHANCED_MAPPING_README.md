# Enhanced SKU Mapping

## Описание

Улучшенный маппинг SKU из Shopify в Bitrix, созданный с учетом полей **Color**, **Size** и **Brand**.

## Статистика

- **Старый маппинг**: 5,471 записей
- **Новый маппинг**: 5,787 записей
- **Улучшение**: +316 записей (+5.8%)
- **Процент совпадений**: 98.77% (5,787 из 5,859 SKU)
- **Несовпадения**: 72 SKU

## Как работает улучшенный маппинг

Маппинг использует несколько стратегий сопоставления:

1. **Точное совпадение по названию** - полное совпадение title из Shopify с NAME из Bitrix
2. **Нормализованное совпадение** - сравнение после нормализации текста
3. **Сопоставление по Model + Color + Brand** - извлечение атрибутов из title и сопоставление
4. **Нечеткое совпадение** - использование similarity score (>0.75)
5. **Fallback на старый маппинг** - если новый не нашел совпадение, используется старый

## Извлечение атрибутов

### Brand (Бренд)
Извлекается из title по кодам: KL, MG, BL, SG, VB, BP, AN, MS, SGR, BLN, ATL, AH

### Color (Цвет)
Извлекается из title по ключевым словам: black, white, blue, red, green, yellow, pink, brown, grey, beige, orange, и т.д.

### Model (Модель)
Извлекается из title после удаления бренда, цвета и типа товара (barefoot, sandals, sneakers, и т.д.)

### Size (Размер)
Извлекается из variant_title в Shopify

## Как включить улучшенный маппинг

1. Откройте файл `orderMapper.js`
2. Найдите секцию `// ===== ENHANCED MAPPING LOGIC =====`
3. Раскомментируйте блок кода (удалите `/*` и `*/`)
4. Раскомментируйте импорт в начале файла:
   ```javascript
   import skuMappingEnhanced from './skuMappingEnhanced.json' assert { type: 'json' };
   ```
5. Закомментируйте или удалите старую логику маппинга (секция `// ===== EXISTING MAPPING LOGIC =====`)

## Файлы

- `skuMapping.json` - старый маппинг (используется по умолчанию)
- `skuMappingEnhanced.json` - новый улучшенный маппинг
- `build_enhanced_sku_mapping.py` - скрипт для генерации улучшенного маппинга

## Регенерация маппинга

Если нужно обновить маппинг после изменений в данных:

```bash
cd C:\Users\sadov\PycharmProjects\ai-multiagent-mvp-system
python build_enhanced_sku_mapping.py
```

## Несовпадения

72 SKU не были сопоставлены. Основные причины:
- Новые товары в Shopify, которых нет в Bitrix
- Различия в названиях, которые не удалось разрешить автоматически
- Товары с нестандартными названиями

Примеры несовпавших SKU:
- ATL00060, ATL00059, ATL00058... (Ballet Flats AN lion Barefoot)
- BLN01334, BLN01335... (BL Replacement insole from cotton)

Эти товары требуют ручного сопоставления или добавления в Bitrix.







